(function($){function buildHTML(elm,ids,template,_products,metadata){var products=[];for(var i=0;i<ids.length;i++){var id=ids[i];for(var j=0;j<_products.length;j++){if(_products[j]["id"]==id){products[i]=_products[j];break}}}elm.append(renderTemplate($(template).html(),products));for(var i=0;i<ids.length;i++){var product=products[i];$('a[rel="__tsd-'+product.id+'"]').click(product,function(a){if(settings.ga_tracking!=null&&typeof _gaq!="undefined"){_gaq.push(["_trackEvent",settings.ga_tracking,metadata["api"],a.data.id+": "+a.data.name])}var b=$(this).attr("href");var c=setTimeout('window.location.href = "'+b+'";',500);callAPI("log_click",{product:a.data.id,api:metadata.api,metadata:metadata},function(){clearTimeout(c);window.location.href=b});return false})}$('a[rel|="__tsd"]').each(function(){var code=$(this).attr("onclick");if(typeof code!="undefined"){$(this).removeAttr("onclick");$(this).click(function(){eval(code)})}});$('a[rel|="__tsd"]').removeAttr("rel")}function renderTemplate(a,b){var c="";for(var d=0;d<b.length;d++){var e=b[d];var f=a.replace(new RegExp("<a","g"),'<a rel="__tsd-'+e["id"]+'"');for(var g in e){f=f.replace(new RegExp("{"+g+"}","g"),e[g])}c+=f}return c}function callAPI(a,b,c){b.key=settings.key;var d="http://api.thesocialdigits.com/v1/"+a+"?callback=?";var e={payload:JSON.stringify(b)};$.getJSON(d,e,c)}var settings={key:"",datasource:function(a,b){},ga_tracking:"The Social Digits"};$.thesocialdigits=function(a){$.extend(settings,a)};$.fn.thesocialdigits=function(a,b,c){var d=this;callAPI(a,b,function(e){if("result"in e){var f={api:a,args:b};settings.datasource(e.result,function(a){buildHTML(d,e.result,c,a,f)})}})}})(jQuery)
