(function($){function buildHTML(elm,ids,template,_products,metadata){var products=[];for(var i=0;i<ids.length;i++){var id=ids[i];for(var j=0;j<_products.length;j++){if(_products[j]["id"]==id){products[i]=_products[j];break}}}elm.append(renderTemplate($(template).html(),products));for(var i=0;i<ids.length;i++){var product=products[i];$('a[rel="__tsd-'+product.id+'"]').click(product,function(a){if(settings.ga_tracking!=null&&typeof _gaq!="undefined"){_gaq.push(["_trackEvent",settings.ga_tracking,metadata["api"],a.data.id+": "+a.data.name])}var b=$(this).attr("href");var c=setTimeout('window.location.href = "'+b+'";',500);callAPI("log_click",{product:a.data.id,api:metadata.api,metadata:metadata},function(){clearTimeout(c);window.location.href=b});return false})}$('a[rel|="__tsd"]').each(function(){var code=$(this).attr("onclick");if(typeof code!="undefined"){$(this).removeAttr("onclick");$(this).click(function(){eval(code)})}});$('a[rel|="__tsd"]').removeAttr("rel")}function renderTemplate(a,b){a=Handlebars.compile(a.replace(new RegExp("<a ","g"),'<a rel="__tsd-{{id}}"'));var c="";for(var d=0;d<b.length;d++){c+=a(b[d])}return c}function callAPI(a,b,c){b.key=settings.key;var d="http://api.thesocialdigits.com/v1/"+a+"?callback=?";var e={payload:toJSON(b)};$.getJSON(d,e,c)}function toJSON(a){if(window.Prototype){return Object.toJSON(a)}else{return JSON.stringify(a)}}language_mapping={da:"danish",nl:"dutch",en:"english",fi:"finnish",fr:"french",de:"german",it:"italian",no:"norwegian",nb:"norwegian",pt:"portuguese",ru:"russian",es:"spanish",sv:"swedish",us:"english"};var settings={key:"",ga_tracking:"The Social Digits"};$.thesocialdigits=function(a){$.extend(settings,a);if(!("language"in settings)){var b=$("html").attr("lang");if(b in language_mapping){settings.language=language_mapping[b]}}if(!("datasource"in settings)){settings.datasource=function(a,b){var c={products:a};if("language"in settings){c.language=settings.language}callAPI("attributes",c,b)}}};$.fn.thesocialdigits=function(a,b,c){var d=this;callAPI(a,b,function(e){if("result"in e){var f={api:a,args:b};settings.datasource(e.result,function(a){buildHTML(d,e.result,c,a,f)})}})}})(jQuery)