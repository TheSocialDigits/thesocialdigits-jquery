(function($){var settings={key:"",datasource:function(products,callback){}};$.thesocialdigits=function(newSettings){settings.key=newSettings.key;settings.datasource=newSettings.datasource};$.fn.thesocialdigits=function(api,args,template){var elm=this;callAPI(api,args,function(data){if("result"in data){var metadata={"api":api,"args":args};settings.datasource(data.result,function(products){buildHTML(elm,data.result,template,products,metadata)})}})};function buildHTML(elm,ids,template,_products,metadata){var products=
[];for(var i in ids){var id=ids[i];for(var j in _products)if(_products[j]["id"]==id){products[i]=_products[j];break}}elm.append(renderTemplate($(template).html(),products));for(var i in ids){var id=ids[i];$('a[rel="__tsd-'+id+'"]').click({"id":id},function(event){var href=$(this).attr("href");var t=setTimeout('window.location.href = "'+href+'";',500);callAPI("__log_click",{"product":event.data.id,"metadata":metadata},function(){clearTimeout(t);window.location.href=href});return false})}$('a[rel|="__tsd"]').removeAttr("rel")}
function renderTemplate(template,products){var output="";for(var i in products){var product=products[i];var tmp=template.replace(new RegExp("<a","g"),'<a rel="__tsd-'+product["id"]+'"');for(var key in product)tmp=tmp.replace(new RegExp("{"+key+"}","g"),product[key]);output+=tmp}return output}function callAPI(api,args,callback){args.key=settings.key;var url="http://api.thesocialdigits.com/v1/"+api+"?callback=?";var data={"payload":JSON.stringify(args)};$.getJSON(url,data,callback)}})(jQuery);

